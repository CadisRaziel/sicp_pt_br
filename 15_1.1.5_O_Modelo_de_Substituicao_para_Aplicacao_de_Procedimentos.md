# 1.1.5 O Modelo de Substituição para Aplicação de Procedimentos

Para avaliar uma combinação cujo operador nomeia um procedimento composto, o interpretador segue praticamente o mesmo processo que para combinações cujos operadores nomeiam procedimentos primitivos, que descrevemos na Seção 1.1.3.

Ou seja, o interpretador avalia os elementos da combinação e aplica o procedimento (que é o valor do operador da combinação) aos argumentos (que são os valores dos operandos da combinação).

Podemos assumir que o mecanismo para aplicar procedimentos primitivos a argumentos está embutido no interpretador. Para procedimentos compostos, o processo de aplicação é o seguinte:

Para aplicar um procedimento composto a argumentos, avalie o corpo do procedimento com cada parâmetro formal substituído pelo argumento correspondente.

Para ilustrar este processo, vamos avaliar a combinação:

(f 5)
onde f é o procedimento definido na Seção 1.1.4.

Começamos recuperando o corpo de f:

(sum-of-squares (+ a 1) (* a 2))

Em seguida, substituímos o parâmetro formal a pelo argumento 5:

(sum-of-squares (+ 5 1) (* 5 2))

Assim, o problema se resume à avaliação de uma combinação com dois operandos e um operador: sum-of-squares.

A avaliação desta combinação envolve três subproblemas:

Devemos avaliar o operador para obter o procedimento a ser aplicado (o procedimento sum-of-squares).

Devemos avaliar os operandos para obter os argumentos (os valores de (+ 5 1) e (* 5 2)).

Agora, (+ 5 1) produz 6 e (* 5 2) produz 10, então devemos aplicar o procedimento sum-of-squares a 6 e 10. Esses valores são substituídos pelos parâmetros formais x e y no corpo de sum-of-squares, reduzindo a expressão a:

(+ (square 6) (square 10))
Se usarmos a definição de square, isso se reduz a:

(+ (* 6 6) (* 10 10))
que se reduz pela multiplicação a:

(+ 36 100)
e finalmente a:

136

O Modelo de Substituição
O processo que acabamos de descrever é chamado de modelo de substituição para aplicação de procedimentos. Ele pode ser considerado um modelo que determina o "significado" da aplicação de procedimentos, no que diz respeito aos procedimentos neste capítulo.

No entanto, há dois pontos que devem ser enfatizados:

O propósito da substituição é nos ajudar a pensar sobre a aplicação de procedimentos, e não fornecer uma descrição de como o interpretador realmente funciona.

Interpretadores típicos não avaliam aplicações de procedimentos manipulando o texto de um procedimento para substituir valores para os parâmetros formais. Na prática, a "substituição" é realizada usando um ambiente local para os parâmetros formais. Discutiremos isso mais detalhadamente no Capítulo 3 e no Capítulo 4, quando examinarmos a implementação de um interpretador em detalhe

Ao longo deste livro, apresentaremos uma sequência de modelos cada vez mais elaborados de como os interpretadores funcionam, culminando com uma implementação completa de um interpretador e um compilador no Capítulo 5.

O modelo de substituição é apenas o primeiro desses modelos — uma forma de começar a pensar formalmente sobre o processo de avaliação. Em geral, ao modelar fenômenos na ciência e na engenharia, começamos com modelos simplificados e incompletos. À medida que examinamos as coisas com maior detalhe, esses modelos simples se tornam inadequados e devem ser substituídos por modelos mais refinados.

O modelo de substituição não é exceção. Em particular, quando abordarmos no Capítulo 3 o uso de procedimentos com "dados mutáveis" (mutable data), veremos que o modelo de substituição se desfaz e deve ser substituído por um modelo mais complicado de aplicação de procedimentos.

De acordo com a descrição de avaliação fornecida na Seção 1.1.3, o interpretador primeiro avalia o operador e os operandos e depois aplica o procedimento resultante aos argumentos resultantes. Este método é conhecido como ordem aplicativos (applicative order).

Esta não é a única maneira de realizar a avaliação. Um modelo de avaliação alternativo, conhecido como ordem normal (normal order), não avaliaria os operandos até que seus valores fossem necessários.

Apesar da simplicidade da ideia de substituição, a tarefa de dar uma definição matemática rigorosa do processo de substituição acaba sendo surpreendentemente complicada.

O problema surge da possibilidade de confusão entre os nomes usados para os parâmetros formais de um procedimento e os nomes (possivelmente idênticos) usados nas expressões às quais o procedimento pode ser aplicado. De fato, há um longo histórico de definições errôneas de substituição na literatura de lógica e semântica de programação.

Consulte Stoy 1977 para uma discussão cuidadosa sobre substituição.


Em vez de avaliar os operandos imediatamente, a avaliação por ordem normal faria o seguinte:

O modelo de ordem normal primeiro substituiria as expressões operandas pelos parâmetros formais até obter uma expressão envolvendo apenas operadores primitivos, e só então realizaria a avaliação.

Se usássemos este método, a avaliação de (f 5) procederia de acordo com a seguinte sequência de expansões:

(sum-of-squares (+ 5 1) (* 5 2))

(+ (square (+ 5 1)) (square (* 5 2)))

(+ (* (+ 5 1) (+ 5 1)) (* (* 5 2) (* 5 2)))

Seguida pelas reduções:

(+ (* 6 6) (* 10 10))

(+ 36 100)

136

Isto fornece a mesma resposta que o nosso modelo de avaliação anterior, mas o processo é diferente. Em particular, as avaliações de (+ 5 1) e (* 5 2) são executadas duas vezes aqui, correspondendo à redução da expressão (* x x) com x substituído, respectivamente, por (+ 5 1) e (* 5 2).

O Lisp usa a avaliação por ordem aplicativos (applicative-order evaluation), em parte devido à eficiência adicional obtida por evitar múltiplas avaliações de expressões, como as ilustradas com (+ 5 1) e (* 5 2) acima.

Mais significativamente, a avaliação por ordem normal (normal-order evaluation) torna-se muito mais complicada de lidar quando saímos do reino de procedimentos que podem ser modelados por substituição.

Por outro lado, a avaliação por ordem normal pode ser uma ferramenta extremamente valiosa, e investigaremos algumas de suas implicações no Capítulo 3 e no Capítulo 4.